!function(){var e,t,n,r,i,a,o,s,c,u,l,d,f,g,p,m,v,h,I,E,x,S,w;return S={localStorage:this.localStorage?!0:!1,postMessage:this.postMessage?!0:!1},S.localStorage||(this.localStorage={setItem:function(){},getItem:function(){},removeItem:function(){}},this.sessionStorage={setItem:function(){},getItem:function(){},removeItem:function(){}}),o=this.localStorage,l=this.sessionStorage,w=function(){var e,t,n;return e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",n=t.replace(/[xy]/g,function(t){var n;return n=(e+16*Math.random())%16|0,e=Math.floor(e/16),"x"===t?n.toString(16):(7&n|8).toString(16)}),n.replace(/-/g,"").toUpperCase()},t={get:function(e){var t,n;return n="(^|;)\\s*"+e+"=([^;\\s]*)",t=document.cookie.match(new RegExp(n)),t&&t.length>=3?decodeURIComponent(t[2]):null},set:function(e,t,n,r,i,a){var o,s,c,u,l;return n&&(o=new Date,o.setTime(o.getTime()+864e5*n)),c=n?"; expires="+o.toGMTString():"",u="; path="+(i||"/"),s=r?"; domain="+r:"",l=a?"; secure":"",document.cookie=e+"="+encodeURIComponent(t)+c+u+s+l},remove:function(e,n,r){return t.set(e,"",-1,n,r)}},v=function(e){return"[object Object]"===Object.prototype.toString.call(e)},g=Array.prototype.every,g||(g=function(e){var t,n,r,i;for(n=!0,r=0,i=this.length;i>r;r++)if(t=this[r],!e(t))return!1;return n}),p=function(e){var t,n,r;for(t in e)r=e[t],e[t]=r;return n=arguments.length>=2?[].slice.call(arguments,1):[],n.forEach(function(n){var i;i=[];for(t in n)r=n[t],i.push(e[t]=r);return i}),e},x={API_PATH:"http://rd.gdatacube.net/dc/html5/sync",PROXY:"http://rd.gdatacube.net/dc/html5/whoami",CLIENT_KEY:"dcagent_client_id",VERSION_NUMBER:"6",appId:"",deviceId:"",accountId:"",channel:"",appVer:"",interval:10,intervalCount:0,initialized:!1,loginTime:0,timer:0},d={max:100,count:0,excludes:[],isReportAllowed:function(e){var t;return d.count<d.max?t=g.call(d.excludes,function(t){return-1===e.indexOf(t)}):void 0}},I={succ:0,fail:0,total:0},c="_DESelf_OSS",h=[],E=function(e){var t,n,r,i,a,o,s,u;if(e.data){(null!=(s=e.data.errors)?s.length:void 0)>d.max&&(e.data.errors=e.data.errors.slice(0,100)),u=e.data;for(t in u)a=u[t],"number"==typeof a&&(r[t]=String(a));if(r=p({headers:m.getBaseSettings()},e.data),x.debug)return x.debug(x.API_PATH,r);if(n=Math.abs(x.onlinetime),!(n>864e3||0>=n))return o=new XMLHttpRequest,o.timeout=3e4,o.open("POST",x.API_PATH,!0),o.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),i=Date.now(),o.onreadystatechange=function(t){var n,r,a;return r=this.status>=200&&this.status<300,4===this.readyState?(n=Date.now()-i,a=r&&"success"===this.responseText,a?(I.succ=1,I.fail=0,I.total=n):(I.fail+=1,I.succ=0,I.total+=n),f.updateEvents({eventid:c,labelmap:JSON.stringify(I),duration:"1"}),a?"function"==typeof e.success?e.success(t):void 0:"function"==typeof e.fail?e.fail(t):void 0):void 0},o.ontimeout=function(){return I.fail+=1,I.succ=0,I.total+=elapsed,f.updateEvents({eventid:c,labelmap:JSON.stringify(I),duration:"1"})},o.send(JSON.stringify(r))}},i="dcagent_client_events",r="dcagent_client_errors",s="dcagent_parent_id",e="dcagent_create_time",u="dcagent_login_time",a="dcagent_interval_key",f={getEvents:function(){return function(){var e;return e=o.getItem(i),e?JSON.parse(e):[]}}(this),getErrors:function(){return function(){var e;return e=o.getItem(r),e?JSON.parse(e):[]}}(this),updateEvents:function(){return function(e,t){var n,r,a,s;if(null==t&&(t=!0),n=f.getEvents(),Array.isArray(e))for(a=0,s=e.length;s>a;a++)r=e[a],n.push(r);else n.push(e);return S.localStorage&&t?o.setItem(i,JSON.stringify(n.slice(0,d.max))):E({data:{events:n}})}}(this),updateErrors:function(){return function(e){var t,n,i,a;if(t=f.getErrors(),Array.isArray(e))for(i=0,a=e.length;a>i;i++)n=e[i],t.push(n);else t.push(e);return S.localStorage?o.setItem(r,JSON.stringify(t.slice(0,d.max))):E({data:{errors:t}})}}(this),clear:function(){return function(){return o.removeItem(i),o.removeItem(r)}}(this)},m={set:function(e,n){return null==n&&(n=w()),localStorage.setItem(e,n),t.set(e,n,365),n},get:function(e){return localStorage.getItem(e)||t.get(e)},getBaseSettings:function(){var t;if(!x.appId)throw new Error("InitError: missing appId");if(!x.accountId)throw new Error("AccountError: unknown accountId");if(!x.deviceId)throw new Error("DeviceError: unknown device");return t=x.intervalCount*x.interval/1e3||1,{appid:x.appId,accountid:x.accountId,uid:x.deviceId,appver:x.appVer,ver:x.VERSION_NUMBER,referer:document.referrer||"",screen:""+(parseInt(screen.width)||0)+"*"+(parseInt(screen.height)||0),logintime:String(parseInt(x.loginTime/1e3)),onlinetime:String(t),crtime:m.get(e)||"",domain:document.domain}},reportOnline:function(e,t,n){var r,i,a;return a={data:{online:{}}},a.data.events=e||[],a.data.errors=t||[],n&&(a.data.reg=n),i=f.getEvents(),r=f.getErrors(),(i.length||r.length)&&(f.clear(),a.data.events=a.data.events.concat(i),a.data.errors=a.data.errors.concat(r),a.data.fail=function(){return f.updateErrors(r),f.updateEvents(i)}),E(a)},injectErrorEvent:function(e){return function(){return e.addEventListener("error",function(e){var t,n,r,i,a;try{if(d.isReportAllowed(e.filename))return d.count+=1,r={},n=["colno","filename","lineno","message"],n.forEach(function(t){return r[t]=e[t]||"0"}),r.stack=(null!=(i=e.error)?i.stack:void 0)||"",r.type=(null!=(a=e.error)?a.name:void 0)||"Error",r.timestamp=parseInt(e.timeStamp/1e3),f.updateErrors(r)}catch(o){return t=o,console.log(t)}},!1)}}(this),appendUID:function(e){var t,n,r,i,a;return r=location.hash,t="!"+e,r?(a=/![0-9A-Z]{32,128}/gi,n=r.match(a),n?(i=n[0].slice(1),e===i||m.get(s)||(x.parentId=i,m.set(s,i)),location.href=location.href.replace(a,t)):location.href+=t):location.href+="#"+t},getServerUID:function(t){var n,r,i;return S.postMessage?(n=function(r){var i;return 0===x.PROXY.indexOf(r.origin)?(i=JSON.parse(r.data),m.set(e,i.crtime),t(i.id),window.removeEventListener("message",n,!1)):void 0},window.addEventListener("message",n,!1),r=document.createElement("iframe"),r.style.display="none",r.src=""+x.PROXY,r.onload=function(){return this.onload=null,this.parentNode.removeChild(this)},i=function(){return document.body.appendChild(r)},document.body?i():document.addEventListener("DOMContentLoaded",i,!1)):t(w())},sendPV:function(e,t){var n,r;return null==e&&(e=location.pathname+location.search),n={page:encodeURIComponent(e),optime:parseInt(x.initializedOn/1e3),ottime:parseInt(Date.now()/1e3),lttime:parseInt(x.loginTime/1e3)},r=[{eventid:"_DESelf_PV",labelmap:JSON.stringify(n),duration:"1"}],m.reportOnline(r,null,t)}},n={version:x.VERSION_NUMBER,init:function(e){var t,n,r,i;if(e.errorReport!==!1&&(e.excludes&&(d.excludes=d.excludes.concat(e.excludes)),m.injectErrorEvent()),x.initialized)throw new Error("InitError: initialized already");if(!e.appId)throw new Error("InitError: missing argument appId");return n=["appId","accountId","appVer"],n.forEach(function(t){return x[t]=e[t]||""}),t=m.get(x.CLIENT_KEY),i=function(t){var n,i,o;return m.set(x.CLIENT_KEY,t),x.deviceId=t,x.accountId||(x.accountId=t),x.debug=e.debug,i=l.getItem(u),i||(i=Date.now(),l.setItem(u,i)),x.loginTime=i,n=l.getItem(a),n||(n="0",l.setItem(a,n)),x.intervalCount=parseInt(n),x.interval=1e3*Math.max(10,parseFloat(e.interval||x.interval)),x.timer=setInterval(function(){return x.intervalCount+=1,l.setItem(a,x.intervalCount),m.reportOnline()},x.interval),x.virus=e.virus===!1?0:1,x.virus&&m.appendUID(t),x.initializedOn=Date.now(),x.initialized=!0,r&&(o={isact:r,isreg:1},x.parentId&&(o.parentid=x.parentId),S.localStorage||(o.localstorage=1)),m.sendPV(null,o)},r=t?0:1,t?i(t):m.getServerUID(i)},onEvent:function(e,t,n){var r,i,a;if(null==t&&(t=0),!e)throw new Error("ArgumentError: missing eventId");if(v(n)){for(i in n)a=n[i],n[i]=encodeURIComponent(a);r=JSON.stringify(n)}else r="";return f.updateEvents({eventid:e,duration:String(t),labelmap:r})},onPageView:function(e){return m.sendPV(e)}},this.DCAgent=n}();